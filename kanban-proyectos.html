<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Kanban de Proyectos</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f4f4f4;
      margin: 0;
      padding: 1rem;
    }

    h1 {
      text-align: center;
      margin-bottom: 0.5rem;
    }

    .filter-area {
      text-align: center;
      margin-bottom: 1rem;
    }

    .kanban-board {
      display: flex;
      gap: 1rem;
      overflow-x: auto;
    }

    .column {
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      flex: 1;
      min-width: 250px;
      display: flex;
      flex-direction: column;
    }

    .column h2 {
      text-align: center;
      background: #e0e0e0;
      margin: 0;
      padding: 0.5rem;
      border-radius: 8px 8px 0 0;
    }

    .card {
      background: #fafafa;
      border: 1px solid #ccc;
      margin: 0.5rem;
      padding: 0.5rem;
      border-radius: 4px;
      cursor: grab;
      transition: all 0.3s ease;
    }

    .card:hover {
      background: #f0f0f0;
    }

    .card .area {
      font-size: 0.8rem;
      color: #666;
      margin-bottom: 0.2rem;
    }

    .subtasks {
      margin-top: 0.5rem;
      padding-left: 1rem;
      display: none;
    }

    .subtasks li {
      font-size: 0.85rem;
      list-style-type: circle;
      margin-bottom: 0.3rem;
    }

    .card.expanded .subtasks {
      display: block;
    }

    .drag-over {
      background-color: #d0ebff !important;
    }

    select {
      padding: 0.4rem;
      font-size: 1rem;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <h1>Kanban de Ideas y Proyectos</h1>
  <div class="filter-area">
    <label for="areaFilter">Filtrar por área: </label>
    <select id="areaFilter">
      <option value="Todas">Todas</option>
    </select>
  </div>
  <div class="kanban-board" id="kanbanBoard">
    <!-- Columnas dinámicas -->
  </div>

  <script>
    const estados = ["Pensamiento", "Primeras pruebas", "Prototipo", "Pulido"];

    const proyectos = [
      {
        id: 1,
        titulo: "Loa al esmarfon",
        area: "Arte interactivo",
        estado: "Prototipo",
        subtareas: [
          "Ajustar generador de aforismos",
          "Pulir estética iPhone",
          "Añadir transiciones suaves"
        ]
      },
      {
        id: 2,
        titulo: "Funcionar Yo (arcade)",
        area: "Videojuego",
        estado: "Primeras pruebas",
        subtareas: [
          "Definir mecánicas de evasión",
          "Diseñar HUD modo café",
          "Escribir diálogos de parodia"
        ]
      },
      {
        id: 3,
        titulo: "Precoz",
        area: "Literatura / Teatro",
        estado: "Pensamiento",
        subtareas: [
          "Esbozar estructura en 3 actos",
          "Refinar tono incómodo pero empático"
        ]
      },
      {
        id: 4,
        titulo: "Málaga libre de turistas",
        area: "Videojuego",
        estado: "Pensamiento",
        subtareas: [
          "Diseñar enemigos: políticos, fondos buitre",
          "Ambientación pixel art"
        ]
      }
    ];

    const board = document.getElementById("kanbanBoard");
    const areaFilter = document.getElementById("areaFilter");

    function crearColumna(estado) {
      const col = document.createElement("div");
      col.className = "column";
      col.dataset.estado = estado;
      col.innerHTML = `<h2>${estado}</h2>`;
      col.addEventListener("dragover", e => {
        e.preventDefault();
        col.classList.add("drag-over");
      });
      col.addEventListener("dragleave", () => {
        col.classList.remove("drag-over");
      });
      col.addEventListener("drop", e => {
        e.preventDefault();
        const id = e.dataTransfer.getData("text/plain");
        const card = document.querySelector(`[data-id='${id}']`);
        col.appendChild(card);
        card.classList.remove("drag-over");

        const proyecto = proyectos.find(p => p.id == id);
        proyecto.estado = col.dataset.estado;

        col.classList.remove("drag-over");
      });
      return col;
    }

    function crearTarjeta(proyecto) {
      const card = document.createElement("div");
      card.className = "card";
      card.draggable = true;
      card.dataset.id = proyecto.id;

      card.innerHTML = `
        <div class="area">${proyecto.area}</div>
        <div class="titulo"><strong>${proyecto.titulo}</strong></div>
        <ul class="subtasks">
          ${proyecto.subtareas.map(t => `<li>${t}</li>`).join("")}
        </ul>
      `;

      card.addEventListener("click", () => {
        card.classList.toggle("expanded");
      });

      card.addEventListener("dragstart", e => {
        e.dataTransfer.setData("text/plain", proyecto.id);
        setTimeout(() => card.classList.add("hide"), 0);
      });

      card.addEventListener("dragend", () => {
        card.classList.remove("hide");
      });

      return card;
    }

    function renderizarTablero(filtroArea = "Todas") {
      board.innerHTML = "";
      estados.forEach(estado => {
        const col = crearColumna(estado);
        proyectos
          .filter(p => p.estado === estado)
          .filter(p => filtroArea === "Todas" || p.area === filtroArea)
          .forEach(p => {
            const card = crearTarjeta(p);
            col.appendChild(card);
          });
        board.appendChild(col);
      });
    }

    function poblarFiltroAreas() {
      const areas = [...new Set(proyectos.map(p => p.area))];
      areas.forEach(area => {
        const opt = document.createElement("option");
        opt.value = area;
        opt.textContent = area;
        areaFilter.appendChild(opt);
      });
    }

    areaFilter.addEventListener("change", () => {
      renderizarTablero(areaFilter.value);
    });

    poblarFiltroAreas();
    renderizarTablero();
  </script>
</body>
</html>
